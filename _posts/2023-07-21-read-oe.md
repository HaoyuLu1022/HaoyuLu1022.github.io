---
title: 'Origin Ensemble PET reconstruction'
date: 2023-07-21
permalink: /posts/2023/07/read-oe/
tags:
  - MCMC
  - PET
  - imaging science
---

# Formulation

## MMSE PET reconstruction

> MMSE = Minimum-mean-square-error

PET imaging can be desribed as $I\times J$ Poisson variables $\mathbf{n}=\{n_{ij}\}$ with expected value $\{\lambda_{ij}\}$

- $n_{ij}$ represents the number of annihilation events from voxel $i\in \{1, \dots, I\}$ detected by detector pair $j\in \{1, \dots, J\}$, which is unobservable
- The set composed of all the voxels is called *image domain*
- The set consisting all the detector pairs is called *projection domain*
  
The statistical relationship between the two domains is usually described by a system matrix $\{\alpha_{ij}\}$

- Element $\alpha_{ij}$ is the probability that event in voxel $i$ is detected by detector pair $j$
- Here the system matrix is supposed to be obtained from scanner geometry, and contains object-specific attenuation information already

In sum, the probabillity $\epsilon_i$ that the whole scanner detects an event from voxel $i$ can be denoted as

$$
\epsilon_i=\sum\limits_{j}\alpha_{ij}, \tag{1}
$$

which is also called the sensitivity of voxel $i$

Let $\mathbf{\lambda}=\{\lambda_i\}$ be the unknown, discrete emission density in *image domain*, where $\lambda_i$ is the emission counts in voxel $i$.

- Then the Poisson variable can be denoted as $\lambda_{ij}=\alpha_{ij}\lambda_{i}$

Considering the complete data $\mathbf{n}$, the likelihood for the estimation $\hat{\mathbf{\lambda}}=\{\hat{\lambda_i}\}$ of emission density goes

$$
\begin{aligned}\mathcal{L}(\hat{\lambda}|\mathbf{n})&=\mathcal{P}_{\hat{\lambda}}(\mathbf{n})=\prod\limits_{i, j}\frac{\hat{\lambda_{ij}}^{n_{ij}}}{n_{ij}!}e^{-\hat{\lambda_{ij}}}\\ \hat{\lambda_{ij}}&=\alpha_{ij}\hat{\lambda_i}\end{aligned}. \tag{2}
$$

However, data acquired in real-world are usually incomplete, say $\mathbf{n}^{\ast}=\{n^{\ast}_j\}$. We need to estimate emission density $\lambda$ from the incomplete data.

$$
n^{\ast}_j=\sum\limits_in_{ij}. \tag{3}
$$

Eventually, our estimation is as follows

$$
\mathbf{\hat{\lambda}}^{(\text{ML})}={\arg\max}_{\mathbf{\hat{\lambda}}}\mathcal{L}(\mathbf{\hat{\lambda}}|\mathbf{n}^{\ast}), \tag{4}
$$

wherein $\mathbf{\hat{\lambda}}^{(\text{ML})}$ is usually calculated iteratively, e.g., EM-type algorithms like MLEM and OSEM

> A particular characteristic of such techniques is their use of FP of the image estimate to the projection domain, which allows to compare the estimated projection data with the acquired projection data. In turn, BP of adequate correction terms is used to amend the image estimate accordingly. Successive FP and BP are repeated a certain number of times, or until a predefined convergence criterion is met.

Different from FP/BP-driven methods above, origin ensemble algorithm directly estimates the emission counts in each voxel $i$.

$$
n_i=\sum\limits_jn_{ij}. \tag{5}
$$

The MMSE estimation about the emission counts in each voxel $i$ can be denoted as

$$
E[n_i|\mathbf{n^{\ast}}]=\sum\limits_{\mathbf{\hat{n}}\in \Theta}n_i(\mathbf{\hat{n}})\mathcal{P}(\mathbf{\hat{n}}|\mathbf{n^{\ast}}), \tag{6}
$$

- $n_i(\mathbf{\hat{n}})$ is the emission counts in voxel $i$, composed of some certain subset of complete data $\mathbf{\hat{n}}$
- $\mathcal{P}(\mathbf{\hat{n}}|\mathbf{n^{\ast}})$ is the posterior of complete data being $\mathbf{\hat{n}}$ conditioned on acquiring $\mathbf{n^{\ast}}$
- we call sets of complete data as *complete data domain* $\Theta$

Finally, emission counts in voxel $i$ can be derived by dividing sensitivity $\epsilon_i$

$$
\hat{\lambda}_i^{(MMSE)}=\begin{cases}E[n_i|\mathbf{n^{\ast}}]/\epsilon_i, \text{for} \thinspace \epsilon_i>0\\0, \text{for}\thinspace \epsilon_i=0\end{cases}. \tag{7}
$$

